This document explains how to automate the creation and deletion of an Amazon EKS (Elastic Kubernetes Service) cluster using Jenkins and Terraform. The process follows standard DevOps practices such as infrastructure validation, approval before deployment, and parameterized execution.
Step 1: Launch EC2 Instance and Install Required Tools
1.1 EC2 Instance Details
Operating System: Ubuntu 22.04
Instance Type: t2.medium
Purpose: Jenkins server and Terraform execution

1.2 Java and Jenkins Installation
#!/bin/bash
sudo apt update -y
wget -O - https://packages.adoptium.net/artifactory/api/gpg/key/public | sudo tee /etc/apt/keyrings/adoptium.asc
echo "deb [signed-by=/etc/apt/keyrings/adoptium.asc] https://packages.adoptium.net/artifactory/deb $(awk -F= '/^VERSION_CODENAME/{print$2}' /etc/os-release) main" | sudo tee /etc/apt/sources.list.d/adoptium.list
sudo apt update -y
sudo apt install temurin-17-jdk -y
java --version
curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee /usr/share/keyrings/jenkins-keyring.asc > /dev/null
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian-stable binary/ | sudo tee /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt update -y
sudo apt install jenkins -y
sudo systemctl start jenkins
sudo systemctl status jenkins

1.3 Terraform Installation
#!/bin/bash
sudo apt update -y
sudo apt install -y gnupg software-properties-common
wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
sudo apt update -y
sudo apt install terraform -y

1.4 kubectl Installation
#!/bin/bash
curl -LO "https://dl.k8s.io/release/$(curl -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
1.5 AWS CLI Installation

#!/bin/bash
sudo apt install unzip -y
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o awscliv2.zip
unzip awscliv2.zip
sudo ./aws/install
Step 2: IAM User Configuration

Create an IAM user in AWS and generate the Access Key and Secret Key.
Ensure the user has permissions for EKS, EC2, IAM, and VPC resources.
Step 3: Jenkins Setup and Configuration

Install the following Jenkins plugin:
Pipeline Stage View
Add AWS credentials in Jenkins:
AWS_Access_Key
AWS_Secret_Key
Step 4: Terraform Configuration
Terraform configuration files include:
VPC
Subnets
IAM roles
EKS cluster
Node groups
Step 5: Jenkins Pipeline for EKS Automation
Pipeline Script
pipeline {
agent any
environment {
AWS_ACCESS_KEY_ID = credentials('AWS_Access_Key')
AWS_SECRET_ACCESS_KEY = credentials('AWS_Secret_Key')
AWS_DEFAULT_REGION = 'ap-south-1'
}
stages {
    stage('Clone Repository') {
        steps {
            checkout scmGit(
                branches: [[name: '*/main']],
                userRemoteConfigs: [[url: '<YOUR_GITHUB_REPO_URL>']]
            )
        }
    }

    stage('Terraform Init') {
        steps {
            dir('terraform') {
                sh 'terraform init'
            }
        }
    }

    stage('Terraform Validate') {
        steps {
            dir('terraform') {
                sh 'terraform validate'
            }
        }
    }

    stage('Terraform Plan') {
        steps {
            dir('terraform') {
                sh 'terraform plan'
            }
            input message: "Proceed with infrastructure changes?", ok: "Yes"
        }
    }

    stage('Apply or Destroy Infrastructure') {
        steps {
            dir('terraform') {
                sh 'terraform $action --auto-approve'
            }
        }
    }
}
}
Pipeline Parameters
Enable "This project is parameterized" and add a Choice Parameter.
Name: action
Choices:
apply
destroy
Cluster Verification
After successful execution:
Open AWS Console
Navigate to EKS
Verify cluster status, node groups, add-ons, and networking resources
Accessing the EKS Cluster
aws eks update-kubeconfig --region ap-south-1 --name <ClusterName>
Test Pod Creation
kubectl run nginx --image=nginx
kubectl get pods
Destroying the Infrastructure
Open the Jenkins job
Select "Build with Parameters"
Choose "destroy"
Run the pipeline
Terminate the EC2 instance after cleanup